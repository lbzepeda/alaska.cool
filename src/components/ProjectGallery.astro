---
import { getLanguageFromUrl } from '../i18n/utils';

const currentLang = getLanguageFromUrl(Astro.url);

// Helper function for translations
const tr = (es: string, en: string, zh: string) => {
  return currentLang === 'es' ? es : currentLang === 'en' ? en : zh;
};

// 🏢 CATEGORÍAS DE PROYECTOS ORGANIZADAS POR TIPO
const projectCategories = [
  {
    id: 'todos',
    name: tr('Todos', 'All', '全部'),
    count: 14
  },
  {
    id: 'aires-acondicionados',
    name: tr('Aires Acondicionados', 'Air Conditioning', '空调'),
    count: 9
  },
  {
    id: 'cuarto-frio',
    name: tr('Cuarto Frío', 'Cold Room', '冷库'),
    count: 2
  },
  {
    id: 'ventilacion',
    name: tr('Ventilación', 'Ventilation', '通风'),
    count: 0
  },
  {
    id: 'comerciales',
    name: 'TikTok',
    count: 3
  }
];

// ✅ MEDIOS ORGANIZADOS POR TIPO DE PROYECTO
const projectMedia = [
  // ❄️ AIRES ACONDICIONADOS - PROYECTO AMPM 
  {
    id: 1,
    src: "/projects/AMPM1.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "Instalación aires acondicionados tipo cassette AMPM",
    title: tr("AMPM - Aires Acondicionados Cassette 60,000 BTU", "AMPM - 60,000 BTU Cassette AC Units", "AMPM - 60,000 BTU 卡匣式空调"),
    description: tr("Instalación de aires acondicionados tipo cassette de 60,000 BTU en sucursales AMPM: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime y otras ubicaciones.", "Installation of 60,000 BTU cassette-type air conditioners in AMPM branches: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime and other locations.", "在AMPM分店安装60,000 BTU卡匣式空调：Las Colinas、Rivas、San Juan del Sur、Masaya、Nandaime等位置。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "tall"
  },
  {
    id: 2,
    src: "/projects/AMPM2.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "Instalación aires acondicionados AMPM - Fase 2",
    title: tr("AMPM - Aires Acondicionados Cassette 60,000 BTU", "AMPM - 60,000 BTU Cassette AC Units", "AMPM - 60,000 BTU 卡匣式空调"),
    description: tr("Instalación de aires acondicionados tipo cassette de 60,000 BTU en sucursales AMPM: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime y otras ubicaciones.", "Installation of 60,000 BTU cassette-type air conditioners in AMPM branches: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime and other locations.", "在AMPM分店安装60,000 BTU卡匣式空调：Las Colinas、Rivas、San Juan del Sur、Masaya、Nandaime等位置。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "medium"
  },
  {
    id: 3,
    src: "/projects/AMPM3.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "Finalización proyecto AMPM - Aires cassette",
    title: tr("AMPM - Aires Acondicionados Cassette 60,000 BTU", "AMPM - 60,000 BTU Cassette AC Units", "AMPM - 60,000 BTU 卡匣式空调"),
    description: tr("Instalación de aires acondicionados tipo cassette de 60,000 BTU en sucursales AMPM: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime y otras ubicaciones.", "Installation of 60,000 BTU cassette-type air conditioners in AMPM branches: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime and other locations.", "在AMPM分店安装60,000 BTU卡匣式空调：Las Colinas、Rivas、San Juan del Sur、Masaya、Nandaime等位置。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "short"
  },

  // ❄️ AIRES ACONDICIONADOS - PROYECTO UNAN
  {
    id: 5,
    src: "/projects/UNAN1.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "Universidad UNAN - Sistema de climatización",
    title: tr("UNAN - Sistema de Climatización Universitario", "UNAN - University HVAC System", "UNAN - 大学空调系统"),
    description: tr("安装完整的大学设施空调系统，具有自动控制和高能效。", "Complete air conditioning system installation in university facilities with automated control and high energy efficiency.", "在大学设施安装完整的空调系统，具有自动控制和高能效。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "medium"
  },
  {
    id: 6,
    src: "/projects/UNAN2.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "UNAN - Equipos de climatización instalados",
    title: tr("UNAN - Equipamiento de Climatización", "UNAN - HVAC Equipment", "UNAN - 空调设备"),
    description: tr("在大学教室和行政区域安装的高效空调设备。", "High efficiency air conditioning equipment installed in university classrooms and administrative spaces.", "在大学教室和行政区域安装的高效空调设备。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "short"
  },
  {
    id: 7,
    src: "/projects/UNAN3.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "UNAN - Detalles técnicos de instalación",
    title: tr("UNAN - Instalación Técnica", "UNAN - Technical Installation", "UNAN - 技术安装"),
    description: tr("空调系统技术安装的详细视图，包括专业管道和连接。", "Detailed view of technical air conditioning system installation with specialized ducts and connections.", "空调系统技术安装的详细视图，包括专业管道和连接。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "tall"
  },
  {
    id: 8,
    src: "/projects/UNAN4.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "UNAN - Instalación completada",
    title: tr("UNAN - Proyecto Completado", "UNAN - Completed Project", "UNAN - 完成项目"),
    description: tr("大学空调系统完成，具有监控和远程控制功能，提高能效。", "University air conditioning system completed with monitoring and remote control for energy efficiency.", "大学空调系统完成，具有监控和远程控制功能，提高能效。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "medium"
  },
  {
    id: 9,
    src: "/projects/UNAN5.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "UNAN - Vista general del proyecto",
    title: tr("UNAN - Vista Panorámica", "UNAN - Panoramic View", "UNAN - 全景视图"),
    description: tr("大学空调项目的全景视图，展示空调系统的完整集成。", "Panoramic view of university HVAC project showing complete air conditioning system integration.", "大学空调项目的全景视图，展示空调系统的完整集成。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "tall"
  },

  // ❄️ AIRES ACONDICIONADOS - PROYECTO PRIMITIVO
  {
    id: 16,
    src: "/projects/Primitivo1.webp",
    type: "image",
    projectType: "aires-acondicionados",
    alt: "Restaurante Primitivo - Aire cassette 40,000 BTU",
    title: tr("Primitivo - Aire Acondicionado Cassette 40,000 BTU", "Primitivo - 40,000 BTU Cassette AC Unit", "Primitivo - 40,000 BTU 卡匣式空调"),
    description: tr("Instalación de aire acondicionado tipo cassette de 40,000 BTU Inverter en el restaurante Primitivo. Se realizó con todas las medidas de seguridad para no dañar nada del lugar, también se realizó mantenimiento general a las demás unidades existentes.", "Installation of 40,000 BTU Inverter cassette-type air conditioner at Primitivo restaurant. Carried out with all safety measures to avoid damage to the premises, including general maintenance of other existing units.", "在Primitivo餐厅安装40,000 BTU变频卡匣式空调。采取所有安全措施以避免对场所造成损害，包括对其他现有设备进行一般维护。"),
    category: tr("Aires Acondicionados", "Air Conditioning", "空调"),
    height: "medium"
  },

  // 🧊 CUARTO FRÍO - SISTEMAS DE REFRIGERACIÓN COMERCIAL
  {
    id: 14,
    src: "/projects/CuartoFrio1.webp",
    type: "image",
    projectType: "cuarto-frio",
    alt: "Cuarto Frío - Sistema de refrigeración comercial",
    title: tr("Cuarto Frío - Refrigeración Comercial", "Cold Room - Commercial Refrigeration", "冷库 - 商业制冷"),
    description: tr("安装商业制冷冷库系统，具有精确的温度控制和优化的能效。", "Cold room system installation for commercial refrigeration with precise temperature control and optimized energy efficiency.", "安装商业制冷冷库系统，具有精确的温度控制和优化的能效。"),
    category: tr("Cuarto Frío", "Cold Room", "冷库"),
    height: "medium"
  },
  {
    id: 15,
    src: "/projects/CuartoFrio2.webp",
    type: "image",
    projectType: "cuarto-frio",
    alt: "Cuarto Frío - Instalación completada",
    title: tr("Cuarto Frío - Sistema Completado", "Cold Room - Completed System", "冷库 - 完成系统"),
    description: tr("完全安装和运行的冷库系统，设计用于使用尖端技术保存易腐产品。", "Fully installed and operational cold room system, designed for perishable product preservation with cutting-edge technology.", "完全安装和运行的冷库系统，设计用于使用尖端技术保存易腐产品。"),
    category: tr("Cuarto Frío", "Cold Room", "冷库"),
    height: "short"
  },

  // 📹 TIKTOK - CONTENIDO DE MARKETING
  {
    id: 11,
    src: "/projects/TrasCamara.webp",
    type: "image",
    projectType: "comerciales",
    alt: "Behind the scenes - Contenido comercial",
    title: tr("Contenido Comercial - Tras Cámaras", "Commercial Content - Behind the Scenes", "商业内容 - 幕后花絮"),
    description: tr("为社交媒体创建的商业和营销内容，展示技术团队的专业流程。", "Commercial and marketing content created for social media showing the professional process of the technical team.", "为社交媒体创建的商业和营销内容，展示技术团队的专业流程。"),
    category: "TikTok",
    height: "medium"
  },
  {
    id: 12,
    src: "/projects/Comercial1.webm",
    type: "video",
    projectType: "comerciales",
    poster: "/projects/Comercial1-poster.webp",
    alt: "Comercial Tempblue - Managua Capital del Infierno",
    title: tr("Comercial Tempblue - Managua Capital del Infierno", "Tempblue Commercial - Managua Capital of Hell", "Tempblue广告 - 马那瓜地狱之都"),
    description: tr("一位女士谈论马那瓜的極端热量，称首都为'地狱'，并解释了Tempblue变频空调如何减少电费，对家庭经济有好处。", "Commercial where a woman talks about Managua's extreme heat, referring to the capital as 'hell', and explains how Tempblue inverter air conditioners reduce electricity bills being good for family economy.", "一位女士谈论马那瓜的极端热量，称首都为'地狱'，并解释了Tempblue变频空调如何减少电费，对家庭经济有好处。"),
    category: "TikTok",
    height: "tall"
  },
  {
    id: 13,
    src: "/projects/Comercial2.webm",
    type: "video",
    projectType: "comerciales",
    poster: "/projects/Comercial2-poster.webp",
    alt: "Comercial Tempblue - Home Office",
    title: tr("Comercial Tempblue - Rescate en Home Office", "Tempblue Commercial - Home Office Rescue", "Tempblue广告 - 家庭办公室救援"),
    description: tr("广告展示了一个人在家庭办公室参加虚拟会议时受到极端热量的痛苦。此时出现了一名专业技术人员，提供了完美的解决方案：Tempblue空调。", "Commercial showing a person in home office during a virtual meeting, suffering from extreme heat. At that moment a specialized technician appears offering the perfect solution: Tempblue air conditioners.", "广告展示了一个人在家庭办公室参加虚拟会议时受到极端热量的痛苦。此时出现了一名专业技术人员，提供了完美的解决方案：Tempblue空调。"),
    category: "TikTok",
    height: "medium"
  }
];

---

<section
  class="relative bg-neutral-50 dark:bg-gradient-to-br dark:from-neutral-900 dark:to-black text-neutral-900 dark:text-white transition-colors duration-300 py-12 pt-28 h-screen overflow-hidden"
>
  <div class="max-w-[1400px] mx-auto px-4 sm:px-6 h-full flex flex-col">
    <div class="text-center mb-6 flex-shrink-0">
      <span class="text-blue-600 dark:text-blue-400 font-medium mb-2 block">
        {tr('Contenido Visual', 'Visual Content', '视觉内容')}
      </span>
      <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-2">
        {tr('Multimedia', 'Multimedia', '多媒体')}
      </h2>
      <p class="text-neutral-600 dark:text-neutral-400 max-w-2xl mx-auto mb-4 text-sm">
        {tr('Descubre nuestro contenido visual: proyectos de climatización, videos de procesos, y contenido de redes sociales. Haz click para explorar.', 'Discover our visual content: HVAC projects, process videos, and social media content. Click to explore.', '发现我们的视觉内容：空调项目、过程视频和社交媒体内容。点击探索。')}
      </p>

      <!-- Filter Tabs -->
      <div class="flex flex-wrap justify-center gap-2 mb-4">
        {projectCategories.map((category) => (
          <button
            class="filter-tab px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 border"
            data-filter={category.id}
            data-active={category.id === 'todos' ? 'true' : 'false'}
          >
            <span class="tab-name">{category.name}</span>
            <span class="tab-count ml-2 px-2 py-1 text-xs rounded-full">
              {category.count}
            </span>
          </button>
        ))}
      </div>
    </div>

    <!-- Scrollable Gallery Container -->
    <div class="flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar relative">
      <!-- Masonry Grid -->
      <div class="masonry-grid columns-1 md:columns-2 lg:columns-3 xl:columns-4 gap-6 space-y-6 pb-6">
      {projectMedia.map((media) => (
        <div 
          class={`
            media-item group relative overflow-hidden rounded-2xl bg-white dark:bg-white/[0.02] 
            border border-neutral-200 dark:border-white/[0.1] 
            hover:shadow-2xl transition-all duration-500 cursor-pointer
            break-inside-avoid mb-6
            ${media.height === 'tall' ? 'h-96' : media.height === 'short' ? 'h-64' : 'h-80'}
          `}
          data-lightbox="projects"
          data-src={media.src}
          data-type={media.type}
          data-poster={(media as any).poster || ''}
          data-title={media.title}
          data-description={media.description}
          data-category={media.category}
          data-project-type={media.projectType}
          data-id={media.id}
        >
          <div class="relative w-full h-full overflow-hidden">
            {media.type === 'video' ? (
              <div class="relative w-full h-full">
                <!-- Video poster as background image -->
                <img 
                  src={(media as any).poster} 
                  alt={media.alt}
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                />
                <!-- Play button overlay -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:bg-white/30 transition-all duration-300">
                    <svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                </div>
              </div>
            ) : (
              <img
                src={media.src}
                alt={media.alt}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                loading="lazy"
              />
            )}
            
            <!-- Overlay gradient -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            
            <!-- Media type badge -->
            <div class="absolute top-3 right-3 px-2 py-1 bg-black/50 text-white text-xs font-medium rounded backdrop-blur-sm">
              {media.type === 'video' ? (
                <div class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                  <span>{tr('Video', 'Video', '视频')}</span>
                </div>
              ) : (
                <div class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21,15 16,10 5,21"/>
                  </svg>
                  <span>{tr('Foto', 'Photo', '照片')}</span>
                </div>
              )}
            </div>
            
            <!-- Category badge -->
            <div class="absolute top-3 left-3 px-3 py-1 bg-blue-600/90 text-white text-xs font-medium rounded-full backdrop-blur-sm">
              {media.category}
            </div>
            
            <!-- Content overlay -->
            <div class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 opacity-0 group-hover:opacity-100">
              <h3 class="text-white text-lg font-semibold mb-2 line-clamp-2">
                {media.title}
              </h3>
              <p class="text-white/90 text-sm line-clamp-2">
                {media.description}
              </p>
              
              <!-- View more button -->
              <div class="mt-3 flex items-center text-blue-300 text-sm font-medium">
                <span>{media.type === 'video' ? tr('Ver video', 'Watch video', '观看视频') : tr('Ver detalles', 'View details', '查看详情')}</span>
                <svg class="w-4 h-4 ml-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      ))}
      </div>
    </div>
    
    <!-- Bottom gradient fade to indicate more content (fixed to viewport bottom) -->
    <div class="scroll-fade-indicator absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-neutral-50 via-neutral-50/80 via-neutral-50/40 to-transparent dark:from-neutral-900 dark:via-neutral-900/80 dark:via-neutral-900/40 pointer-events-none z-10"></div>
  </div>

  <!-- Lightbox Modal -->
  <div id="lightbox-modal" class="fixed inset-0 hidden bg-black/95 backdrop-blur-sm">
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <!-- Close button -->
      <button 
        id="lightbox-close" 
        class="absolute top-6 right-6 w-10 h-10 bg-black/30 hover:bg-black/50 text-white/70 hover:text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-sm"
        aria-label="Close lightbox"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- Navigation arrows -->
      <button 
        id="lightbox-prev" 
        class="absolute left-6 top-1/2 -translate-y-1/2 w-14 h-14 bg-white/20 hover:bg-white/30 text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-md border-2 border-white/40 hover:border-white/60 shadow-2xl"
        aria-label="Previous image"
      >
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <button 
        id="lightbox-next" 
        class="absolute right-6 top-1/2 -translate-y-1/2 w-14 h-14 bg-white/20 hover:bg-white/30 text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-md border-2 border-white/40 hover:border-white/60 shadow-2xl"
        aria-label="Next image"
      >
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

      <!-- Main content -->
      <div class="w-full max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 max-h-[90vh]">
        <!-- Media container -->
        <div class="lg:col-span-2 flex items-center justify-center">
          <div class="relative max-w-full max-h-full">
            <img 
              id="lightbox-image" 
              src="" 
              alt="" 
              class="max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl"
            />
            <video
              id="lightbox-video"
              class="max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl hidden"
              controls
              preload="metadata"
              playsinline
              poster=""
            >
              <source id="lightbox-video-source" src="" type="video/webm" />
              {tr('Tu navegador no soporta video WebM.', 'Your browser does not support WebM video.', '您的浏览器不支持WebM视频。')}
            </video>
          </div>
        </div>

        <!-- Info sidebar -->
        <div class="lg:col-span-1 text-white space-y-6 overflow-y-auto">
          <div>
            <div id="lightbox-category" class="inline-block px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded-full mb-4"></div>
            <h2 id="lightbox-title" class="text-2xl font-bold mb-4"></h2>
            <p id="lightbox-description" class="text-white/90 leading-relaxed"></p>
          </div>
          
          <!-- Project details -->
          <div class="border-t border-white/20 pt-6">
            <h3 class="text-lg font-semibold mb-3">
              {tr('Detalles del Proyecto', 'Project Details', '项目详情')}
            </h3>
            <div class="space-y-3 text-sm">
              <div class="flex justify-between">
                <span class="text-white/70">{tr('Estado:', 'Status:', '状态：')}</span>
                <span class="text-green-400 font-medium">{tr('Completado', 'Completed', '已完成')}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-white/70">{tr('Tipo:', 'Type:', '类型：')}</span>
                <span id="lightbox-type" class="font-medium"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-white/70">{tr('Servicio:', 'Service:', '服务：')}</span>
                <span class="font-medium">{tr('Climatización', 'HVAC', '空调')}</span>
              </div>
            </div>
          </div>

          <!-- TikTok Link (only shown for TikTok content) -->
          <div id="tiktok-link-section" class="border-t border-white/20 pt-6 hidden">
            <a 
              href="https://www.tiktok.com/@alaskacool" 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-violet-600 hover:from-pink-600 hover:to-violet-700 text-white rounded-full text-sm font-medium transition-all duration-300 hover:scale-105"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
              </svg>
              <span>{tr('Ver en TikTok', 'View on TikTok', '在TikTok上观看')}</span>
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
              </svg>
            </a>
          </div>

          <!-- Media counter -->
          <div class="border-t border-white/20 pt-6">
            <div class="space-y-2">
              <div class="flex items-center justify-between text-sm text-white/70">
                <span id="lightbox-counter">1 / 10</span>
                <span>{tr('Galería multimedia', 'Media gallery', '多媒体画廊')}</span>
              </div>
              <div class="text-xs text-white/50 space-y-1">
                <div>{tr('• Usa ← → para navegar entre medios', '• Use ← → to navigate between media', '• 使用 ← → 在媒体间导航')}</div>
                <div>{tr('• Presiona Espacio para pausar/reproducir videos', '• Press Space to pause/play videos', '• 按空格键暂停/播放视频')}</div>
                <div>{tr('• Presiona ESC o click fuera para cerrar', '• Press ESC or click outside to close', '• 按ESC或点击外部关闭')}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .masonry-grid {
    column-gap: 1.5rem;
  }
  
  .masonry-grid > * {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Filter Tabs Styles */
  .filter-tab {
    background: transparent;
    color: theme('colors.neutral.600');
    border-color: theme('colors.neutral.300');
  }

  .filter-tab:hover {
    background: theme('colors.blue.50');
    border-color: theme('colors.blue.300');
    color: theme('colors.blue.700');
  }

  .filter-tab[data-active="true"] {
    background: theme('colors.blue.600');
    border-color: theme('colors.blue.600');
    color: white;
  }

  .filter-tab .tab-count {
    background: theme('colors.neutral.200');
    color: theme('colors.neutral.600');
  }

  .filter-tab:hover .tab-count {
    background: theme('colors.blue.100');
    color: theme('colors.blue.800');
  }

  .filter-tab[data-active="true"] .tab-count {
    background: theme('colors.blue.500');
    color: white;
  }

  /* Dark mode styles */
  :is(.dark) .filter-tab {
    color: theme('colors.neutral.400');
    border-color: theme('colors.neutral.600');
  }

  :is(.dark) .filter-tab:hover {
    background: theme('colors.blue.900/20');
    border-color: theme('colors.blue.400');
    color: theme('colors.blue.300');
  }

  :is(.dark) .filter-tab[data-active="true"] {
    background: theme('colors.blue.600');
    border-color: theme('colors.blue.600');
    color: white;
  }

  :is(.dark) .filter-tab .tab-count {
    background: theme('colors.neutral.700');
    color: theme('colors.neutral.300');
  }

  :is(.dark) .filter-tab:hover .tab-count {
    background: theme('colors.blue.800');
    color: theme('colors.blue.200');
  }

  :is(.dark) .filter-tab[data-active="true"] .tab-count {
    background: theme('colors.blue.500');
    color: white;
  }

  /* Media item visibility */
  .media-item.hidden {
    display: none;
  }

  .media-item {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .media-item.filtering {
    opacity: 0;
    transform: scale(0.95);
  }

  /* Custom scrollbar styles */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: theme('colors.blue.400') theme('colors.neutral.200');
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: theme('colors.neutral.200');
    border-radius: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: theme('colors.blue.400');
    border-radius: 4px;
    transition: background 0.3s ease;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: theme('colors.blue.500');
  }

  /* Dark mode scrollbar */
  :is(.dark) .custom-scrollbar {
    scrollbar-color: theme('colors.blue.400') theme('colors.neutral.700');
  }

  :is(.dark) .custom-scrollbar::-webkit-scrollbar-track {
    background: theme('colors.neutral.700');
  }

  :is(.dark) .custom-scrollbar::-webkit-scrollbar-thumb {
    background: theme('colors.blue.400');
  }

  :is(.dark) .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: theme('colors.blue.300');
  }

  /* Scroll fade indicator */
  .scroll-fade-indicator {
    transition: opacity 0.3s ease;
  }

  /* Safari-specific hover fixes */
  @supports (-webkit-appearance: none) {
    .media-item img {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      will-change: transform;
    }
    
    .media-item:hover img {
      transform: scale(1.1);
    }
  }

</style>

<script>
  // Disable Console Ninja for this script to prevent injection
  if (typeof window !== 'undefined' && (window as any).ninjaDisableLogging) {
    (window as any).ninjaDisableLogging();
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    'use strict';
    
    // Gallery functionality
    const filterTabs = document.querySelectorAll('.filter-tab');
    const mediaItems = document.querySelectorAll('.media-item');
    const modal = document.getElementById('lightbox-modal');
    const closeBtn = document.getElementById('lightbox-close');
    const prevBtn = document.getElementById('lightbox-prev');
    const nextBtn = document.getElementById('lightbox-next');
    const image = document.getElementById('lightbox-image');
    const video = document.getElementById('lightbox-video');
    const videoSource = document.getElementById('lightbox-video-source');
    const title = document.getElementById('lightbox-title');
    const description = document.getElementById('lightbox-description');
    const category = document.getElementById('lightbox-category');
    const type = document.getElementById('lightbox-type');
    const counter = document.getElementById('lightbox-counter');
    const scrollContainer = document.querySelector('.custom-scrollbar');
    const fadeIndicator = document.querySelector('.scroll-fade-indicator');

    let activeFilter: string = 'todos';
    let filteredItems: HTMLElement[] = [];
    let currentIndex: number = 0;

    // Scroll fade indicator functionality
    function updateScrollFade() {
      if (scrollContainer && fadeIndicator) {
        const { scrollTop, scrollHeight, clientHeight } = scrollContainer as HTMLElement;
        const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10; // 10px threshold
        
        if (isAtBottom) {
          (fadeIndicator as HTMLElement).style.opacity = '0';
        } else {
          (fadeIndicator as HTMLElement).style.opacity = '1';
        }
      }
    }

    // Add scroll event listener
    if (scrollContainer) {
      scrollContainer.addEventListener('scroll', updateScrollFade);
      // Initial check
      setTimeout(updateScrollFade, 100);
    }

    function updateFilteredItems() {
      if (activeFilter === 'todos') {
        filteredItems = Array.from(mediaItems) as HTMLElement[];
      } else {
        filteredItems = Array.from(mediaItems).filter(function(item) {
          return (item as HTMLElement).dataset.projectType === activeFilter;
        }) as HTMLElement[];
      }
    }

    function filterMedia(filterType: string) {
      activeFilter = filterType;
      
      filterTabs.forEach(function(tab) {
        if ((tab as HTMLElement).dataset.filter === filterType) {
          (tab as HTMLElement).dataset.active = 'true';
        } else {
          (tab as HTMLElement).dataset.active = 'false';
        }
      });

      mediaItems.forEach(function(item) {
        item.classList.add('filtering');
        
        setTimeout(function() {
          if (filterType === 'todos' || (item as HTMLElement).dataset.projectType === filterType) {
            item.classList.remove('hidden', 'filtering');
          } else {
            item.classList.add('hidden');
            item.classList.remove('filtering');
          }
        }, 150);
      });

      setTimeout(function() {
        updateFilteredItems();
        updateScrollFade(); // Update fade indicator after filtering
      }, 200);
    }

    updateFilteredItems();

    filterTabs.forEach(function(tab) {
      tab.addEventListener('click', function() {
        const filterType = (tab as HTMLElement).dataset.filter;
        if (filterType) {
          filterMedia(filterType);
        }
      });
    });
    
    function openLightbox(index: number) {
      const item = filteredItems[index];
      const mediaSrc = item.dataset.src;
      const mediaType = item.dataset.type;
      const mediaTitle = item.dataset.title;
      const mediaDescription = item.dataset.description;
      const mediaCategory = item.dataset.category;
      const mediaProjectType = item.dataset.projectType;
      const mediaPoster = item.dataset.poster;
      
      
      if (image) image.classList.add('hidden');
      if (video) video.classList.add('hidden');
      
      if (mediaType === 'video') {
        if (video && videoSource) {
          video.classList.remove('hidden');
          (video as HTMLVideoElement).pause();
          (video as HTMLVideoElement).currentTime = 0;
          
          if (mediaSrc) {
            (videoSource as HTMLSourceElement).src = mediaSrc;
          }
          if (mediaPoster) {
            (video as HTMLVideoElement).poster = mediaPoster;
          }
          (video as HTMLVideoElement).load();
        }
      } else {
        if (image && mediaSrc && mediaTitle) {
          image.classList.remove('hidden');
          (image as HTMLImageElement).src = mediaSrc;
          (image as HTMLImageElement).alt = mediaTitle;
        }
      }
      
      if (title && mediaTitle) title.textContent = mediaTitle;
      if (description && mediaDescription) description.textContent = mediaDescription;
      if (category && mediaCategory) category.textContent = mediaCategory;
      if (type && mediaCategory) type.textContent = mediaCategory;
      
      // Show/hide TikTok link based on project type
      const tiktokLinkSection = document.getElementById('tiktok-link-section');
      if (tiktokLinkSection) {
        if (mediaProjectType === 'comerciales') {
          tiktokLinkSection.classList.remove('hidden');
        } else {
          tiktokLinkSection.classList.add('hidden');
        }
      }
      
      const projectTypeName = activeFilter === 'todos' ? 'Todos' : 
        activeFilter === 'aires-acondicionados' ? 'Aires Acondicionados' :
        activeFilter === 'cuarto-frio' ? 'Cuarto Frío' :
        activeFilter === 'ventilacion' ? 'Ventilación' :
        activeFilter === 'comerciales' ? 'TikTok' : '';
      const currentFilter = projectTypeName;
      if (counter) {
        counter.textContent = (index + 1) + ' / ' + filteredItems.length + ' - ' + currentFilter;
      }
      
      if (modal) modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      currentIndex = index;
    }
    
    function closeLightbox() {
      if (video && !video.classList.contains('hidden')) {
        (video as HTMLVideoElement).pause();
      }
      
      if (modal) modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    
    function nextMedia() {
      if (video && !video.classList.contains('hidden')) {
        (video as HTMLVideoElement).pause();
      }
      
      currentIndex = (currentIndex + 1) % filteredItems.length;
      openLightbox(currentIndex);
    }
    
    function prevMedia() {
      if (video && !video.classList.contains('hidden')) {
        (video as HTMLVideoElement).pause();
      }
      
      currentIndex = (currentIndex - 1 + filteredItems.length) % filteredItems.length;
      openLightbox(currentIndex);
    }
    
    mediaItems.forEach(function(item) {
      item.addEventListener('click', function() {
        const filteredIndex = filteredItems.findIndex(function(filteredItem) {
          return filteredItem === item;
        });
        if (filteredIndex !== -1) {
          openLightbox(filteredIndex);
        }
      });
    });
    
    if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
    if (nextBtn) nextBtn.addEventListener('click', nextMedia);
    if (prevBtn) prevBtn.addEventListener('click', prevMedia);
    
    if (modal) {
      modal.addEventListener('click', function(e) {
        if (e.target === modal) closeLightbox();
      });
    }
    
    document.addEventListener('keydown', function(e) {
      if (modal && !modal.classList.contains('hidden')) {
        switch(e.key) {
          case 'Escape':
            closeLightbox();
            break;
          case 'ArrowLeft':
            prevMedia();
            break;
          case 'ArrowRight':
            nextMedia();
            break;
          case ' ':
            e.preventDefault();
            if (video && !video.classList.contains('hidden')) {
              if ((video as HTMLVideoElement).paused) {
                (video as HTMLVideoElement).play().catch(function() {});
              } else {
                (video as HTMLVideoElement).pause();
              }
            }
            break;
        }
      }
    });
    
    if (video) {
      video.addEventListener('error', function() {
        if (video) video.classList.add('hidden');
      });
    }
  });
</script>