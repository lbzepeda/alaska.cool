---
import { getLanguageFromUrl } from '../i18n/utils';

const currentLang = getLanguageFromUrl(Astro.url);

// üè¢ CATEGOR√çAS DE PROYECTOS ORGANIZADAS POR EMPRESA
const projectCategories = [
  {
    id: 'todos',
    name: currentLang === 'es' ? 'Todos' : 'All',
    count: 10
  },
  {
    id: 'ampm',
    name: 'AMPM',
    count: 2
  },
  {
    id: 'unan',
    name: 'UNAN',
    count: 6
  },
  {
    id: 'contenido',
    name: currentLang === 'es' ? 'Contenido' : 'Content',
    count: 2
  }
];

// ‚úÖ MEDIOS ORGANIZADOS POR EMPRESA/PROYECTO
const projectMedia = [
  // üè™ PROYECTO AMPM
  {
    id: 1,
    src: "/projects/AMPM1.webp",
    type: "image",
    company: "ampm",
    alt: "Instalaci√≥n aires acondicionados tipo cassette AMPM",
    title: currentLang === 'es' ? "AMPM - Aires Cassette 60,000 BTU" : "AMPM - 60,000 BTU Cassette AC Units",
    description: currentLang === 'es' ? 
      "Instalaci√≥n de aires acondicionados tipo cassette de 60,000 BTU en sucursales AMPM: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime y otras ubicaciones." :
      "Installation of 60,000 BTU cassette-type air conditioners in AMPM branches: Las Colinas, Rivas, San Juan del Sur, Masaya, Nandaime and other locations.",
    category: currentLang === 'es' ? "Comercial" : "Commercial",
    height: "tall"
  },
  {
    id: 10,
    src: "/projects/v09044g40000d16s53vog65isb89cq80.webm",
    type: "video",
    company: "ampm",
    poster: "/projects/AMPM1.webp",
    alt: "Video promocional proyecto AMPM",
    title: currentLang === 'es' ? "AMPM - Video Promocional" : "AMPM - Promotional Video",
    description: currentLang === 'es' ? 
      "Video promocional mostrando la instalaci√≥n de aires cassette de 60,000 BTU en las sucursales AMPM a nivel nacional." :
      "Promotional video showing the installation of 60,000 BTU cassette AC units in AMPM branches nationwide.",
    category: currentLang === 'es' ? "Comercial" : "Commercial",
    height: "tall"
  },

  // üéì PROYECTO UNAN
  {
    id: 2,
    src: "/projects/v09044g40000d0jrptnog65g9q0lahf0.webm",
    type: "video",
    company: "unan",
    poster: "/projects/UNAN1.webp",
    alt: "Video del proceso de instalaci√≥n - UNAN", 
    title: currentLang === 'es' ? "UNAN - Proceso de Instalaci√≥n" : "UNAN - Installation Process",
    description: currentLang === 'es' ? 
      "Video detallado del proceso de instalaci√≥n de sistema de climatizaci√≥n en Universidad Nacional Aut√≥noma de Nicaragua." :
      "Detailed video of HVAC system installation process at National Autonomous University of Nicaragua.",
    category: currentLang === 'es' ? "Educativo" : "Educational",
    height: "tall"
  },
  {
    id: 3,
    src: "/projects/UNAN1.webp",
    type: "image",
    company: "unan",
    alt: "Universidad UNAN - Sistema de climatizaci√≥n",
    title: currentLang === 'es' ? "UNAN - Proyecto Universitario" : "UNAN - University Project",
    description: currentLang === 'es' ? 
      "Instalaci√≥n completa de sistema de climatizaci√≥n en instalaciones universitarias con control automatizado." :
      "Complete HVAC system installation in university facilities with automated control.",
    category: currentLang === 'es' ? "Educativo" : "Educational",
    height: "medium"
  },
  {
    id: 4,
    src: "/projects/UNAN2.webp",
    type: "image",
    company: "unan",
    alt: "UNAN - Equipos de climatizaci√≥n instalados",
    title: currentLang === 'es' ? "UNAN - Equipamiento Fase 2" : "UNAN - Equipment Phase 2",
    description: currentLang === 'es' ? 
      "Segunda fase del proyecto universitario con instalaci√≥n de equipos de alta eficiencia energ√©tica." :
      "Second phase of university project with high energy efficiency equipment installation.",
    category: currentLang === 'es' ? "Educativo" : "Educational",
    height: "short"
  },
  {
    id: 5,
    src: "/projects/UNAN3.webp",
    type: "image",
    company: "unan",
    alt: "UNAN - Detalles t√©cnicos de instalaci√≥n",
    title: currentLang === 'es' ? "UNAN - Detalles T√©cnicos" : "UNAN - Technical Details",
    description: currentLang === 'es' ? 
      "Vista detallada de componentes y conexiones del sistema de climatizaci√≥n universitario." :
      "Detailed view of university HVAC system components and connections.",
    category: currentLang === 'es' ? "T√©cnico" : "Technical",
    height: "tall"
  },
  {
    id: 6,
    src: "/projects/UNAN4.webp",
    type: "image",
    company: "unan",
    alt: "UNAN - Instalaci√≥n completada",
    title: currentLang === 'es' ? "UNAN - Finalizaci√≥n del Proyecto" : "UNAN - Project Completion",
    description: currentLang === 'es' ? 
      "Proyecto universitario completado con sistemas de monitoreo y control remoto implementados." :
      "University project completed with monitoring systems and remote control implemented.",
    category: currentLang === 'es' ? "Educativo" : "Educational",
    height: "medium"
  },
  {
    id: 7,
    src: "/projects/UNAN5.webp",
    type: "image",
    company: "unan",
    alt: "UNAN - Vista general del proyecto",
    title: currentLang === 'es' ? "UNAN - Vista General" : "UNAN - General View",
    description: currentLang === 'es' ? 
      "Vista panor√°mica del proyecto universitario mostrando la integraci√≥n completa del sistema." :
      "Panoramic view of university project showing complete system integration.",
    category: currentLang === 'es' ? "Educativo" : "Educational",
    height: "tall"
  },

  // üìπ CONTENIDO AUDIOVISUAL
  {
    id: 8,
    src: "/projects/TrasCamara.webp",
    type: "image",
    company: "contenido",
    alt: "Behind the scenes - Proceso de trabajo",
    title: currentLang === 'es' ? "Tras C√°maras - Proceso" : "Behind the Scenes - Process",
    description: currentLang === 'es' ? 
      "Vista tras c√°maras del proceso de instalaci√≥n mostrando el profesionalismo del equipo t√©cnico." :
      "Behind the scenes view of installation process showing technical team professionalism.",
    category: currentLang === 'es' ? "Proceso" : "Process",
    height: "medium"
  },
  {
    id: 9,
    src: "/projects/v09044g40000d0lmv07og65pio5p0go0.webm",
    type: "video",
    company: "contenido",
    poster: "/projects/TrasCamara.webp",
    alt: "Video t√©cnico - Proceso de instalaci√≥n",
    title: currentLang === 'es' ? "Video T√©cnico - Instalaci√≥n" : "Technical Video - Installation",
    description: currentLang === 'es' ? 
      "Video t√©cnico detallado mostrando metodolog√≠a y t√©cnicas profesionales de instalaci√≥n." :
      "Detailed technical video showing professional installation methodology and techniques.",
    category: currentLang === 'es' ? "T√©cnico" : "Technical",
    height: "tall"
  }
];

---

<section
  class="relative bg-neutral-50 dark:bg-gradient-to-br dark:from-neutral-900 dark:to-black text-neutral-900 dark:text-white transition-colors duration-300 py-16"
>
  <div class="max-w-[1400px] mx-auto px-4 sm:px-6">
    <div class="text-center mb-12">
      <span class="text-blue-600 dark:text-blue-400 font-medium mb-2 block">
        {currentLang === 'es' ? 'Contenido Visual' : 'Visual Content'}
      </span>
      <h2 class="text-3xl font-semibold text-slate-900 dark:text-white mb-4">
        {currentLang === 'es' ? 'Multimedia' : 'Multimedia'}
      </h2>
      <p class="text-neutral-600 dark:text-neutral-400 max-w-2xl mx-auto mb-8">
        {currentLang === 'es' 
          ? 'Descubre nuestro contenido visual: proyectos de climatizaci√≥n, videos de procesos, y contenido de redes sociales. Haz click para explorar.'
          : 'Discover our visual content: HVAC projects, process videos, and social media content. Click to explore.'
        }
      </p>

      <!-- Filter Tabs -->
      <div class="flex flex-wrap justify-center gap-2 mb-8">
        {projectCategories.map((category) => (
          <button
            class="filter-tab px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 border"
            data-filter={category.id}
            data-active={category.id === 'todos' ? 'true' : 'false'}
          >
            <span class="tab-name">{category.name}</span>
            <span class="tab-count ml-2 px-2 py-1 text-xs rounded-full">
              {category.count}
            </span>
          </button>
        ))}
      </div>
    </div>

    <!-- Masonry Grid -->
    <div class="masonry-grid columns-1 md:columns-2 lg:columns-3 xl:columns-4 gap-6 space-y-6">
      {projectMedia.map((media) => (
        <div 
          class={`
            media-item group relative overflow-hidden rounded-2xl bg-white dark:bg-white/[0.02] 
            border border-neutral-200 dark:border-white/[0.1] 
            hover:shadow-2xl transition-all duration-500 cursor-pointer
            break-inside-avoid mb-6
            ${media.height === 'tall' ? 'h-96' : media.height === 'short' ? 'h-64' : 'h-80'}
          `}
          data-lightbox="projects"
          data-src={media.src}
          data-type={media.type}
          data-poster={media.poster || ''}
          data-title={media.title}
          data-description={media.description}
          data-category={media.category}
          data-company={media.company}
          data-id={media.id}
        >
          <div class="relative w-full h-full overflow-hidden">
            {media.type === 'video' ? (
              <div class="relative w-full h-full">
                <video
                  class="w-full h-full object-cover transition-all duration-500 group-hover:scale-110"
                  poster={media.poster}
                  muted
                  preload="metadata"
                >
                  <source src={media.src} type="video/webm" />
                  {currentLang === 'es' ? 'Tu navegador no soporta video WebM.' : 'Your browser does not support WebM video.'}
                </video>
                <!-- Play button overlay -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:bg-white/30 transition-all duration-300">
                    <svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                </div>
              </div>
            ) : (
              <img
                src={media.src}
                alt={media.alt}
                class="w-full h-full object-cover transition-all duration-500 group-hover:scale-110"
                loading="lazy"
              />
            )}
            
            <!-- Overlay gradient -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            
            <!-- Media type badge -->
            <div class="absolute top-3 right-3 px-2 py-1 bg-black/50 text-white text-xs font-medium rounded backdrop-blur-sm">
              {media.type === 'video' ? (
                <div class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                  <span>{currentLang === 'es' ? 'Video' : 'Video'}</span>
                </div>
              ) : (
                <div class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21,15 16,10 5,21"/>
                  </svg>
                  <span>{currentLang === 'es' ? 'Foto' : 'Photo'}</span>
                </div>
              )}
            </div>
            
            <!-- Category badge -->
            <div class="absolute top-3 left-3 px-3 py-1 bg-blue-600/90 text-white text-xs font-medium rounded-full backdrop-blur-sm">
              {media.category}
            </div>
            
            <!-- Content overlay -->
            <div class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 opacity-0 group-hover:opacity-100">
              <h3 class="text-white text-lg font-semibold mb-2 line-clamp-2">
                {media.title}
              </h3>
              <p class="text-white/90 text-sm line-clamp-2">
                {media.description}
              </p>
              
              <!-- View more button -->
              <div class="mt-3 flex items-center text-blue-300 text-sm font-medium">
                <span>{currentLang === 'es' ? (media.type === 'video' ? 'Ver video' : 'Ver detalles') : (media.type === 'video' ? 'Watch video' : 'View details')}</span>
                <svg class="w-4 h-4 ml-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div id="lightbox-modal" class="fixed inset-0 z-50 hidden bg-black/95 backdrop-blur-sm">
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <!-- Close button -->
      <button 
        id="lightbox-close" 
        class="absolute top-4 right-4 z-50 w-12 h-12 bg-black/50 hover:bg-black/70 text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-sm border border-white/20 hover:border-white/40"
        aria-label="Close lightbox"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- Navigation arrows -->
      <button 
        id="lightbox-prev" 
        class="absolute left-4 top-1/2 -translate-y-1/2 z-50 w-12 h-12 bg-black/50 hover:bg-black/70 text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-sm border border-white/20 hover:border-white/40"
        aria-label="Previous image"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <button 
        id="lightbox-next" 
        class="absolute right-4 top-1/2 -translate-y-1/2 z-50 w-12 h-12 bg-black/50 hover:bg-black/70 text-white rounded-full flex items-center justify-center transition-all duration-200 backdrop-blur-sm border border-white/20 hover:border-white/40"
        aria-label="Next image"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

      <!-- Main content -->
      <div class="w-full max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 max-h-[90vh]">
        <!-- Media container -->
        <div class="lg:col-span-2 flex items-center justify-center">
          <div class="relative max-w-full max-h-full">
            <img 
              id="lightbox-image" 
              src="" 
              alt="" 
              class="max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl"
            />
            <video
              id="lightbox-video"
              class="max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl hidden"
              controls
              preload="metadata"
            >
              <source id="lightbox-video-source" src="" type="video/webm" />
              {currentLang === 'es' ? 'Tu navegador no soporta video WebM.' : 'Your browser does not support WebM video.'}
            </video>
          </div>
        </div>

        <!-- Info sidebar -->
        <div class="lg:col-span-1 text-white space-y-6 overflow-y-auto">
          <div>
            <div id="lightbox-category" class="inline-block px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded-full mb-4"></div>
            <h2 id="lightbox-title" class="text-2xl font-bold mb-4"></h2>
            <p id="lightbox-description" class="text-white/90 leading-relaxed"></p>
          </div>
          
          <!-- Project details -->
          <div class="border-t border-white/20 pt-6">
            <h3 class="text-lg font-semibold mb-3">
              {currentLang === 'es' ? 'Detalles del Proyecto' : 'Project Details'}
            </h3>
            <div class="space-y-3 text-sm">
              <div class="flex justify-between">
                <span class="text-white/70">{currentLang === 'es' ? 'Estado:' : 'Status:'}</span>
                <span class="text-green-400 font-medium">{currentLang === 'es' ? 'Completado' : 'Completed'}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-white/70">{currentLang === 'es' ? 'Tipo:' : 'Type:'}</span>
                <span id="lightbox-type" class="font-medium"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-white/70">{currentLang === 'es' ? 'Servicio:' : 'Service:'}</span>
                <span class="font-medium">{currentLang === 'es' ? 'Climatizaci√≥n' : 'HVAC'}</span>
              </div>
            </div>
          </div>

          <!-- Media counter -->
          <div class="border-t border-white/20 pt-6">
            <div class="space-y-2">
              <div class="flex items-center justify-between text-sm text-white/70">
                <span id="lightbox-counter">1 / 10</span>
                <span>{currentLang === 'es' ? 'Galer√≠a multimedia' : 'Media gallery'}</span>
              </div>
              <div class="text-xs text-white/50 space-y-1">
                <div>{currentLang === 'es' ? '‚Ä¢ Usa ‚Üê ‚Üí para navegar entre medios' : '‚Ä¢ Use ‚Üê ‚Üí to navigate between media'}</div>
                <div>{currentLang === 'es' ? '‚Ä¢ Presiona Espacio para pausar/reproducir videos' : '‚Ä¢ Press Space to pause/play videos'}</div>
                <div>{currentLang === 'es' ? '‚Ä¢ Presiona ESC o click fuera para cerrar' : '‚Ä¢ Press ESC or click outside to close'}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .masonry-grid {
    column-gap: 1.5rem;
  }
  
  .masonry-grid > * {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Filter Tabs Styles */
  .filter-tab {
    background: transparent;
    color: theme('colors.neutral.600');
    border-color: theme('colors.neutral.300');
  }

  .filter-tab:hover {
    background: theme('colors.blue.50');
    border-color: theme('colors.blue.300');
    color: theme('colors.blue.700');
  }

  .filter-tab[data-active="true"] {
    background: theme('colors.blue.600');
    border-color: theme('colors.blue.600');
    color: white;
  }

  .filter-tab .tab-count {
    background: theme('colors.neutral.200');
    color: theme('colors.neutral.600');
  }

  .filter-tab:hover .tab-count {
    background: theme('colors.blue.100');
    color: theme('colors.blue.800');
  }

  .filter-tab[data-active="true"] .tab-count {
    background: theme('colors.blue.500');
    color: white;
  }

  /* Dark mode styles */
  :is(.dark) .filter-tab {
    color: theme('colors.neutral.400');
    border-color: theme('colors.neutral.600');
  }

  :is(.dark) .filter-tab:hover {
    background: theme('colors.blue.900/20');
    border-color: theme('colors.blue.400');
    color: theme('colors.blue.300');
  }

  :is(.dark) .filter-tab[data-active="true"] {
    background: theme('colors.blue.600');
    border-color: theme('colors.blue.600');
    color: white;
  }

  :is(.dark) .filter-tab .tab-count {
    background: theme('colors.neutral.700');
    color: theme('colors.neutral.300');
  }

  :is(.dark) .filter-tab:hover .tab-count {
    background: theme('colors.blue.800');
    color: theme('colors.blue.200');
  }

  :is(.dark) .filter-tab[data-active="true"] .tab-count {
    background: theme('colors.blue.500');
    color: white;
  }

  /* Media item visibility */
  .media-item.hidden {
    display: none;
  }

  .media-item {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .media-item.filtering {
    opacity: 0;
    transform: scale(0.95);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterTabs = document.querySelectorAll('.filter-tab');
    const mediaItems = document.querySelectorAll('.media-item');
    let activeFilter = 'todos';
    let filteredItems: Element[] = [];

    // Lightbox elements
    const modal = document.getElementById('lightbox-modal');
    const closeBtn = document.getElementById('lightbox-close');
    const prevBtn = document.getElementById('lightbox-prev');
    const nextBtn = document.getElementById('lightbox-next');
    const image = document.getElementById('lightbox-image') as HTMLImageElement;
    const video = document.getElementById('lightbox-video') as HTMLVideoElement;
    const videoSource = document.getElementById('lightbox-video-source') as HTMLSourceElement;
    const title = document.getElementById('lightbox-title');
    const description = document.getElementById('lightbox-description');
    const category = document.getElementById('lightbox-category');
    const type = document.getElementById('lightbox-type');
    const counter = document.getElementById('lightbox-counter');
    
    let currentIndex = 0;

    // Initialize filtered items
    function updateFilteredItems(): void {
      if (activeFilter === 'todos') {
        filteredItems = Array.from(mediaItems);
      } else {
        filteredItems = Array.from(mediaItems).filter(item => {
          const itemElement = item as HTMLElement;
          return itemElement.dataset.company === activeFilter;
        });
      }
    }

    // Filter functionality
    function filterMedia(filterType: string): void {
      activeFilter = filterType;
      
      // Update tab states
      filterTabs.forEach(tab => {
        const tabElement = tab as HTMLElement;
        if (tabElement.dataset.filter === filterType) {
          tabElement.dataset.active = 'true';
        } else {
          tabElement.dataset.active = 'false';
        }
      });

      // Filter media items with animation
      mediaItems.forEach(item => {
        const itemElement = item as HTMLElement;
        itemElement.classList.add('filtering');
        
        setTimeout(() => {
          if (filterType === 'todos' || itemElement.dataset.company === filterType) {
            itemElement.classList.remove('hidden', 'filtering');
          } else {
            itemElement.classList.add('hidden');
            itemElement.classList.remove('filtering');
          }
        }, 150);
      });

      // Update filtered items for lightbox navigation
      setTimeout(() => {
        updateFilteredItems();
      }, 200);
    }

    // Initialize
    updateFilteredItems();

    // Add click listeners to filter tabs
    filterTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabElement = tab as HTMLElement;
        const filterType = tabElement.dataset.filter;
        if (filterType) {
          filterMedia(filterType);
        }
      });
    });
    
    function openLightbox(index: number): void {
      const item = filteredItems[index] as HTMLElement;
      const mediaSrc = item.dataset.src;
      const mediaType = item.dataset.type;
      const mediaTitle = item.dataset.title;
      const mediaDescription = item.dataset.description;
      const mediaCategory = item.dataset.category;
      const mediaCompany = item.dataset.company;
      
      // Hide both media elements first
      if (image) image.classList.add('hidden');
      if (video) video.classList.add('hidden');
      
      if (mediaType === 'video') {
        // Show video player
        if (video) {
          video.classList.remove('hidden');
          if (videoSource && mediaSrc) {
            videoSource.src = mediaSrc;
          }
          video.load(); // Reload the video element
          video.currentTime = 0; // Reset to beginning
        }
      } else {
        // Show image
        if (image && mediaSrc && mediaTitle) {
          image.classList.remove('hidden');
          image.src = mediaSrc;
          image.alt = mediaTitle;
        }
      }
      
      if (title && mediaTitle) title.textContent = mediaTitle;
      if (description && mediaDescription) description.textContent = mediaDescription;
      if (category && mediaCategory) category.textContent = mediaCategory;
      if (type && mediaCategory) type.textContent = mediaCategory;
      
      // Update counter with company info
      const companyName = mediaCompany?.toUpperCase() || '';
      const currentFilter = activeFilter === 'todos' ? 'Todos' : companyName;
      if (counter) {
        counter.textContent = `${index + 1} / ${filteredItems.length} - ${currentFilter}`;
      }
      
      if (modal) modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      currentIndex = index;
    }
    
    function closeLightbox(): void {
      // Pause video if playing
      if (video && !video.classList.contains('hidden')) {
        video.pause();
      }
      
      if (modal) modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    
    function nextMedia(): void {
      // Pause current video if playing
      if (video && !video.classList.contains('hidden')) {
        video.pause();
      }
      
      currentIndex = (currentIndex + 1) % filteredItems.length;
      openLightbox(currentIndex);
    }
    
    function prevMedia(): void {
      // Pause current video if playing
      if (video && !video.classList.contains('hidden')) {
        video.pause();
      }
      
      currentIndex = (currentIndex - 1 + filteredItems.length) % filteredItems.length;
      openLightbox(currentIndex);
    }
    
    // Event listeners for media items
    mediaItems.forEach((item, index) => {
      item.addEventListener('click', () => {
        // Find the index in filtered items
        const filteredIndex = filteredItems.findIndex(filteredItem => filteredItem === item);
        if (filteredIndex !== -1) {
          openLightbox(filteredIndex);
        }
      });
    });
    
    if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
    if (nextBtn) nextBtn.addEventListener('click', nextMedia);
    if (prevBtn) prevBtn.addEventListener('click', prevMedia);
    
    // Close on backdrop click
    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeLightbox();
      });
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (modal && !modal.classList.contains('hidden')) {
        switch(e.key) {
          case 'Escape':
            closeLightbox();
            break;
          case 'ArrowLeft':
            prevMedia();
            break;
          case 'ArrowRight':
            nextMedia();
            break;
          case ' ': // Spacebar for play/pause video
            e.preventDefault();
            if (video && !video.classList.contains('hidden')) {
              if (video.paused) {
                video.play().catch(console.error);
              } else {
                video.pause();
              }
            }
            break;
        }
      }
    });
    
    // Video event listeners
    if (video) {
      video.addEventListener('loadedmetadata', function() {
        // Video metadata loaded, ready to play
        console.log('Video loaded successfully');
      });
      
      video.addEventListener('error', function(e) {
        console.error('Error loading video:', e);
        // Fallback: hide video and show error message
        if (video) video.classList.add('hidden');
        // You could add an error message element here
      });
    }
  });
</script>