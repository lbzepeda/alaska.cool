---
import {
  VIDEO_URL_RESIDENTIAL_AC,
  VIDEO_URL_INDUSTRIAL_FAN,
  VIDEO_URL_INDUSTRIAL_AC,
} from "../../config";

const IMAGES = {
  residential: {
    src: "../assets/residencial_ac_preview.webp",
    width: 800,
    height: 600,
    placeholder: "data:image/webp;base64,...",
  },
  industrial: {
    src: "../assets/industrial_comercial_preview.webp",
    width: 800,
    height: 600,
    placeholder: "data:image/webp;base64,...",
  },
  fan: {
    src: "../assets/industrial_fan_preview.webp",
    width: 800,
    height: 600,
    placeholder: "data:image/webp;base64,...",
  },
};
---

<link
  rel="preload"
  as="image"
  href={IMAGES.residential.src}
  imagesrcset={`${IMAGES.residential.src} 800w`}
  imagesizes="(max-width: 768px) 100vw, 50vw"
/>
<link
  rel="preload"
  as="image"
  href={IMAGES.industrial.src}
  imagesrcset={`${IMAGES.industrial.src} 800w`}
  imagesizes="100vw"
/>

<section id="home" class="bg-[#FBFBFD] dark:bg-black py-12 pt-28">
  <div class="max-w-[1200px] mx-auto px-4 sm:px-6">
    <div class="text-center max-w-xl mx-auto mb-12">
      <span class="text-blue-600 dark:text-blue-400 font-medium mb-2 block">
        Descubra Alaska Cool
      </span>
      <h2
        class="text-4xl md:text-3xl font-semibold text-slate-900 dark:text-white mb-4"
      >
        Conozca Nuestros Productos | Servicios en Climatización
      </h2>
      <p class="text-slate-600 dark:text-slate-400 text-lg">
        Innovación y confort para cada espacio
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- AC Residencial -->
      <div
        class="relative overflow-hidden rounded-xl group cursor-pointer h-[400px]"
      >
        <div
          class="absolute inset-0 z-10 bg-black/50 group-hover:bg-black/30 transition-colors duration-500"
        >
        </div>
        <picture>
          <source
            type="image/webp"
            srcset={`${IMAGES.residential.src} 800w`}
            sizes="(max-width: 768px) 100vw, 50vw"
          />
          <img
            src={IMAGES.residential.src}
            alt="AC Residencial Preview"
            class="absolute inset-0 w-full h-full object-cover dark:invert"
            loading="eager"
            width={IMAGES.residential.width}
            height={IMAGES.residential.height}
            decoding="async"
            style={`background-image: url(${IMAGES.residential.placeholder}); background-size: cover;`}
            fetchpriority="high"
          />
        </picture>
        <video
          class="absolute inset-0 w-full h-full object-cover opacity-0 lazy-video"
          loop
          muted
          playsinline
          preload="none"
          data-src={VIDEO_URL_RESIDENTIAL_AC}
          width={IMAGES.residential.width}
          height={IMAGES.residential.height}></video>
        <div
          class="absolute inset-0 z-20 flex flex-col items-center justify-center p-8"
        >
          <h3
            class="text-3xl md:text-4xl font-medium tracking-tight text-white text-center mb-2"
          >
            Residencial
          </h3>
          <p class="text-white/90 text-lg text-center">
            Soluciones de climatización para tu hogar
          </p>
        </div>
      </div>

      <!-- Industrial Comerssial -->
      <div
        class="relative overflow-hidden rounded-xl group cursor-pointer h-[400px]"
      >
        <div
          class="absolute inset-0 z-10 bg-black/50 group-hover:bg-black/30 transition-colors duration-500"
        >
        </div>
        <picture>
          <source
            type="image/webp"
            srcset={`${IMAGES.industrial.src} 800w`}
            sizes="(max-width: 768px) 100vw, 50vw"
          />
          <img
            src={IMAGES.industrial.src}
            alt="Industrial AC Preview"
            class="absolute inset-0 w-full h-full object-cover"
            loading="eager"
            width={IMAGES.industrial.width}
            height={IMAGES.industrial.height}
            decoding="async"
            style={`background-image: url(${IMAGES.industrial.placeholder}); background-size: cover;`}
            fetchpriority="high"
          />
        </picture>
        <video
          class="absolute inset-0 w-full h-full object-cover opacity-0 lazy-video"
          loop
          muted
          playsinline
          preload="none"
          data-src={VIDEO_URL_INDUSTRIAL_AC}
          width={IMAGES.industrial.width}
          height={IMAGES.industrial.height}
        >
        </video>
        <div
          class="absolute inset-0 z-20 flex flex-col items-center justify-center p-8"
        >
          <h3
            class="text-3xl md:text-4xl font-medium tracking-tight text-white text-center mb-2"
          >
            Industriales | Comerciales
          </h3>
          <p class="text-white/90 text-lg text-center">
            Instalación y mantenimiento profesional
          </p>
        </div>
      </div>

      <!-- Forced Ventilation -->
      <div
        class="relative overflow-hidden rounded-xl group cursor-pointer h-[400px] md:col-span-2"
      >
        <div
          class="absolute inset-0 z-10 bg-black/50 group-hover:bg-black/30 transition-colors duration-500"
        >
        </div>
        <picture>
          <source
            type="image/webp"
            srcset={`${IMAGES.fan.src} 800w, ${IMAGES.fan.src} 1200w`}
            sizes="100vw"
          />
          <img
            src={IMAGES.industrial.src}
            alt="Ventilación Forzada Preview"
            class="absolute inset-0 w-full h-full object-cover"
            loading="eager"
            width={IMAGES.industrial.width}
            height={IMAGES.industrial.height}
            style={`background-image: url(${IMAGES.industrial.placeholder}); background-size: cover;`}
            fetchpriority="high"
          />
        </picture>
        <video
          class="absolute inset-0 w-full h-full object-cover opacity-0 lazy-video"
          loop
          muted
          playsinline
          preload="none"
          data-src={VIDEO_URL_INDUSTRIAL_FAN}
          width={IMAGES.industrial.width}
          height={IMAGES.industrial.height}></video>
        <div
          class="absolute inset-0 z-20 flex flex-col items-center justify-center p-8"
        >
          <h3
            class="text-3xl md:text-4xl font-medium tracking-tight text-white text-center mb-2"
          >
            Ventilación Forzada
          </h3>
          <p class="text-white/90 text-lg text-center">
            Ventilación de alto rendimiento
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const videoObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const video = entry.target as HTMLVideoElement;
        if (entry.isIntersecting) {
          if (video.dataset.src && !video.src) {
            video.src = video.dataset.src;
          }
          video.load();
        }
      });
    },
    {
      rootMargin: "50px 0px",
      threshold: 0.1,
    },
  );

  document.addEventListener("DOMContentLoaded", () => {
    const videoContainers = document.querySelectorAll(".group");
    const videos = document.querySelectorAll(".lazy-video");

    videos.forEach((video) => videoObserver.observe(video));

    videoContainers.forEach((container) => {
      const video = container.querySelector("video");
      if (!video) return;

      let playTimeout: ReturnType<typeof setTimeout>;

      const playVideo = () => {
        video.classList.remove("opacity-0");
        video.currentTime = 0;
        video.play().catch(() => {});
      };

      const enterHandler = () => {
        clearTimeout(playTimeout);
        playTimeout = setTimeout(() => {
          if (video.readyState >= 3) {
            playVideo();
          } else {
            video.load();
            video.addEventListener("canplay", playVideo, { once: true });
          }
        }, 100);
      };

      const leaveHandler = () => {
        clearTimeout(playTimeout);
        video.classList.add("opacity-0");
        video.pause();
        video.currentTime = 0;
      };

      container.addEventListener("mouseenter", enterHandler, {
        passive: true,
      });
      container.addEventListener("mouseleave", leaveHandler, {
        passive: true,
      });
    });
  });
</script>

<style>
  .lazy-video {
    will-change: transform, opacity;
    transition: opacity 0.3s ease-out;
  }

  @media (prefers-reduced-motion: no-preference) {
    .group:hover .lazy-video {
      transform: scale(1.05);
      transition:
        transform 0.5s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.3s ease-out;
    }
  }
</style>
